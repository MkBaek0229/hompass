<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>자가진단 체크 페이지</title>

    <link href="/main.css" rel="stylesheet">

</head>
<body class="font-['Paperozi-900'] mt-[10%]">
{{>layouts/header}}
<main class="max-w-[475px] mx-auto px-4 pt-4 pb-28">
    <section>
        <h1 class="text-[24px] flex">사용자 목표 : 벌크업</h1>
    </section>

    <section class="flex gap-8 font-['Paperozi-600'] mt-4 mb-4">
    <div>
        <h2 class="font-['Paperozi-800'] text-[18px]">목표 칼로리</h2>
        <p id="kcal">2822<span>kcal</span></p>
    </div>
    <div>
        <p><div class="w-[15px] h-[15px] bg-blue-400 inline-block rounded-full"></div> <span class="font-['Paperozi-800']">탄수화물</span> <span id="carb">352<span>g</span></span></p>
        <p><div class="w-[15px] h-[15px] bg-green-400 inline-block rounded-full"></div><span></span> <span class="font-['Paperozi-800']">단백질</span><span id="protein">212<span>g</span></span></p>
        <p><div class="w-[15px] h-[15px] bg-red-400 inline-block rounded-full"></div><span></span> <span class="font-['Paperozi-800']">지방</span> <span id="fat">63<span>g</span></span></p>
    </div>
    </section>

    <seciton>
        <div class="flex justify-between">
            <span>단백질</span>
            <span>탄수화물</span>
            <span>지방</span>
        </div>
    </seciton>


</main>
{{>layouts/footer}}
</body>
<script>
    let kcal = document.querySelector("#kcal");
    let carb = document.querySelector("#carb");
    let protein = document.querySelector("#protein");
    let fat = document.querySelector("#fat");

    (async () => {
      const usersRaw = localStorage.getItem("users");
          if (!usersRaw) {
            alert("존재 하지 않은 유저입니다. 등록을 먼저해주세요.");
            window.location.href = "/user"; // BMI 입력 페이지 경로로 맞춰줘
          }

          let user;
          try {
            user = JSON.parse(usersRaw);
          } catch (e) {
            console.error("user parse error", e);
            alert("임시 저장 데이터가 손상되었습니다. 다시 입력해주세요.");
            localStorage.removeItem("users");
            window.location.href = "/user";
          }

          const user_id = user.id;
              console.log(user_id);

          if (user_id == null) {
            alert("유저 ID가 없습니다. 다시 등록해주세요.");
            window.location.href = "/user";
          }
          try {
              const res = await fetch(`/api/user/${user_id}/user_result`, {
              method: "GET",
            });

            if (!res.ok) {
              const txt = await res.text().catch(() => "");
              console.error("save failed", res.status, txt);
              alert("저장에 실패했습니다. 잠시 후 다시 시도해주세요.");
              return;
            }

             // 응답 JSON 꺼내기
              const result = await res.json();
              console.log(result);

            kcal.innerText = result[0].kcal;
            carb.innerText = result[0].carb;
            protein.innerText = result[0].protein;
            fat.innerText = result[0].fat;
          } catch (err) {
            console.error(err);
            alert("네트워크 오류가 발생했습니다. 잠시 후 다시 시도해주세요.");
          }
        })();
</script>

</html>